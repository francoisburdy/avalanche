<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/intervenants/addIntervenant.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/intervenants/addIntervenant.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

angular.module('myApp').controller('AddIntervenantCtrl', function($scope, $routeParams, $location, $document, Operation, Parametres, Translation) {

    function init() {
        //if (cordova) cordova.plugins.Keyboard.disableScroll(false);

        Translation.getTranslation($scope);
        $scope.tmpPersonnel = Operation.getTmpPersonnel();
        
        if(!$scope.tmpPersonnel) {
            $scope.newIntervenant = {};
            $scope.newIntervenant.beginDate = new Date();
            $scope.newIntervenant.endDate = null;
            $scope.newIntervenant.missions = [];
        } else {
            $scope.newIntervenant = $scope.tmpPersonnel;
        }
        
        $scope.missions = Parametres.getMissions();
        $scope.metiers = Parametres.getMetiers();

        if($routeParams.lib) {
            $scope.newIntervenant.metier = Parametres.getMetier($routeParams.lib);
        }
    }
    init();

    /**
     * Remplit l'intervenant temporaire et le passe à l'écran de confirmation
     */
    $scope.goToConfirmation = function() {
        if(!$scope.newIntervenant.numero) {
            navigator.notification.alert("Saisissez le numéro de l'intervenant", null, "Numéro intervenant", "OK");
        } else if(!$scope.newIntervenant.metier) {
            navigator.notification.alert("Choisissez le métier de l'intervenant", null, "Corps de métier", "OK");
        } else {
            let libMission = $scope.newSelectedMission || $scope.selectedMission;
            $scope.newIntervenant.missions = libMission ? [{libelle: libMission, beginDate: new Date()}] : [];

            Operation.addTmpPersonnel($scope.newIntervenant);
        }
    }

    $scope.addIntervenant = function() {
        // TODO : ajouter confirmation
        Operation.addPersonnel();
        $location.url('/dashboard');
    }

    $scope.cancelAddIntervenant = function() {
        Operation.cancelTmpPersonnel();
        $location.url('/dashboard');
    }

    $scope.launchCamera = function() {
        console.log(navigator.camera);
        if(navigator.camera !== undefined) {
            navigator.camera.getPicture(onSuccess, onFail, { 
                quality: 40,
                encodingType: Camera.EncodingType.JPEG,
                correctOrientation: true,
                targetWidth: 600,
                destinationType: Camera.DestinationType.DATA_URL
            });
        } else {
            navigator.notification.alert(
                "Votre appareil photo n'est pas compatible avec cette fonctionnalité", 
                null, "Appareil photo incompatible", "OK"
            );
        }
    }
    
    function onSuccess(imageData) {
        console.log('image : onSuccess');
        var imgSrc = 'data:image/jpeg;base64,' + imageData;
        $scope.newIntervenant.image = imgSrc; 
        $scope.$apply();
    }
    
    function onFail(message) {
        console.log('image : onFail');
    }

    /**
     * Ecoute les évenements clavier pour cacher afficher les boutons flottants
     */
    window.addEventListener('native.keyboardshow', function(e) {
        $scope.keyboardVisible = true;
        $scope.$apply();        
    });

    window.addEventListener('native.keyboardhide', function(e) {
        $scope.keyboardVisible = false;
        $scope.$apply();
    });

});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#avalanche">avalanche</a></li><li><a href="global.html#exitApp">exitApp</a></li><li><a href="global.html#onDeviceReady">onDeviceReady</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Feb 15 2017 14:30:37 GMT+0100 (Paris, Madrid)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>

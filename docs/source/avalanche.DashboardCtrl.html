<!doctype html><html>  <head>    <meta charset="utf-8">    <base href="../">    <title>JSDoc: source : dashboard.js</title>    <link href="css/prettify-tomorrow.css" type="text/css" rel="stylesheet">    <link href="css/site.css" type="text/css" rel="stylesheet">  </head>  <body ng-app="">    <nav id="toc">      <input placeholder="Filter" id="filter-input" class="col12 block field" type="text">      <div class="nav-wrapper">      <h2><a href="index.html">Index</a></h2>      <ul class="module">        <!-- avalanche -->        <h2 class="module">          <a chref="" ng-click="moduleavalanche = !moduleavalanche">            module: avalanche          </a>          <i ng-cloak="" ng-show="moduleavalanche">+</i>        </h2>        <li id="avalanche" ng-hide="moduleavalanche">          <ul class="group">            <h2>              <a href="" ng-click="avalanchecontrollers = !avalanchecontrollers">                controllers              </a>              <i ng-cloak="" ng-show="avalanchecontrollers">+</i>            </h2>            <ul ng-hide="avalanchecontrollers">              <li>                <a href="avalanche.AddIntervenantCtrl.html">AddIntervenantCtrl</a>              </li><li>                <a href="avalanche.AddVictimeCtrl.html">AddVictimeCtrl</a>              </li><li>                <a href="avalanche.DashboardCtrl.html">DashboardCtrl</a>              </li><li>                <a href="avalanche.DetailsMetierCtrl.html">DetailsMetierCtrl</a>              </li><li>                <a href="avalanche.EditIntervenantCtrl.html">EditIntervenantCtrl</a>              </li><li>                <a href="avalanche.EditVictimeCtrl.html">EditVictimeCtrl</a>              </li><li>                <a href="avalanche.HistoriqueCtrl.html">HistoriqueCtrl</a>              </li><li>                <a href="avalanche.HomeCtrl.html">HomeCtrl</a>              </li><li>                <a href="avalanche.JournalCtrl.html">JournalCtrl</a>              </li><li>                <a href="avalanche.MenuCtrl.html">MenuCtrl</a>              </li><li>                <a href="avalanche.ParametresCtrl.html">ParametresCtrl</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="avalancheglobal = !avalancheglobal">                global              </a>              <i ng-cloak="" ng-show="avalancheglobal">+</i>            </h2>            <ul ng-hide="avalancheglobal">              <li>                <a href="avalanche.app.html">app</a>              </li><li>                <a href="avalanche.routes.html">routes</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="avalancheservices = !avalancheservices">                services              </a>              <i ng-cloak="" ng-show="avalancheservices">+</i>            </h2>            <ul ng-hide="avalancheservices">              <li>                <a href="avalanche.Export.html">Export</a>              </li><li>                <a href="avalanche.Global.html">Global</a>              </li><li>                <a href="avalanche.Operation.html">Operation</a>              </li><li>                <a href="avalanche.Parametres.html">Parametres</a>              </li><li>                <a href="avalanche.Translation.html">Translation</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="avalanchehelpers = !avalanchehelpers">                helpers              </a>              <i ng-cloak="" ng-show="avalanchehelpers">+</i>            </h2>            <ul ng-hide="avalanchehelpers">              <li>                <a href="avalanche.JS%20helpers.html">JS helpers</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="avalanchefilters = !avalanchefilters">                filters              </a>              <i ng-cloak="" ng-show="avalanchefilters">+</i>            </h2>            <ul ng-hide="avalanchefilters">              <li>                <a href="avalanche.lowerMetier.html">lowerMetier</a>              </li><li>                <a href="avalanche.plurielMetier.html">plurielMetier</a>              </li>            </ul>          </ul>        </li>      </ul><ul class="module">        <!-- undefined -->        <h2 class="module">          <a chref="" ng-click="moduleundefined = !moduleundefined">            module: undefined          </a>          <i ng-cloak="" ng-show="moduleundefined">+</i>        </h2>        <li id="undefined" ng-hide="moduleundefined">          <ul class="group">            <h2>              <a href="" ng-click="undefinedClasses = !undefinedClasses">                Classes              </a>              <i ng-cloak="" ng-show="undefinedClasses">+</i>            </h2>            <ul ng-hide="undefinedClasses">              <li>                <a href="Event.html">Event</a>              </li><li>                <a href="Journal.html">Journal</a>              </li><li>                <a href="Langue.html">Langue</a>              </li><li>                <a href="Metier.html">Metier</a>              </li><li>                <a href="Mission.html">Mission</a>              </li><li>                <a href="Operation.html">Operation</a>              </li><li>                <a href="Personnel.html">Personnel</a>              </li><li>                <a href="Victime.html">Victime</a>              </li><li>                <a href="VictimeStatus.html">VictimeStatus</a>              </li>            </ul>          </ul><ul class="group">            <h2>              <a href="" ng-click="undefinedGénéralités = !undefinedGénéralités">                Généralités              </a>              <i ng-cloak="" ng-show="undefinedGénéralités">+</i>            </h2>            <ul ng-hide="undefinedGénéralités">              <li>                <a href="scope.html">scope</a>              </li><li>                <a href="service.html">service</a>              </li>            </ul>          </ul>        </li>      </ul>      </div>    </nav>    <div id="content" class="page-wrap">      <h1 class="title">        source : dashboard.js      </h1>      <div id="main" class="big-container">        <!-- source code html -->        <article>          <pre class="prettyprint source linenums"><code>'use strict';/** * Contrôleur associé à la vue dashboard de l'application. * * @ngdoc controllers * @memberof avalanche * @name DashboardCtrl * @param {service} $scope  - native scope AngularJS service * @param {service} $location  - native location AngularJS service * @param {service} $rootScope  - native rootScope AngularJS service * @param {service} Operation  - Avalanche Operation AngularJS service * @param {service} Parametres  - Avalanche Parametres AngularJS service * @param {service} Global  - Avalanche Global AngularJS service * @param {service} Translation  - Avalanche Translation AngularJS service */angular.module('myApp').controller('DashboardCtrl', function ($scope, $location, $rootScope, Operation, Parametres, Global, Translation) {  /**   * Initialise le scope du controller.   * @memberof DashboardCtrl   * @function init   */  function init() {    Translation.getTranslation($scope);    $scope.operation = Operation.getOperation();    $scope.metiers = Parametres.getMetiers();    angular.element(document).ready(function () {      $scope.goTab(Global.getDashboardTab());      $scope.$apply();    });  }  init();  /**   * Retourne le nombre de personnels présents sur zone de l'opération   * courante pour un corps de métier donné.   * @memberof DashboardCtrl   * @func nbPersonnels   * @param {string} metier - Corps de métier.   * @returns {int} Nombre d'intervenants.   */  $scope.nbPersonnels = function (metier) {    if (!$scope.operation || !$scope.operation.personnels) return 0;    let compteur = 0;    for (let p of $scope.operation.personnels)      if (p.metier.libelle == metier && !p.endDate) compteur++;    return compteur;  };  /**   * Retourne le nombre de personnels encore présents sur le site.   * @memberof DashboardCtrl   * @func nbActivePersonnels   * @returns {int} Nombre d'intervenants de l'opération courante, zéro s'il   * n'y a pas d'opération en cours.   */  $scope.nbActivePersonnels = function () {    if (!$scope.operation || !$scope.operation.personnels) return 0;    let compteur = 0;    for (let p of $scope.operation.personnels) {      if (!p.endDate) compteur++;    }    return compteur;  };  /**   * Termine une opération. Enregistre également dans le   * journal toutes les évènements effectués.   * @memberof DashboardCtrl   * @func terminateOperation   */  $scope.terminateOperation = function () {    /* TODO: Vérifier que tout le monde est sorti */    let nbPersonnes = $scope.operation.victimes.filter(function (v) {        return !v.endDate      }).length      + $scope.operation.personnels.filter(function (p) {        return !p.endDate      }).length;    let msg = nbPersonnes > 0      ? nbPersonnes + " personnes sont encore sur zone !\n" + $scope.translation.dashboard.confirmTerminateMsg      : $scope.translation.dashboard.confirmTerminateMsg;    navigator.notification.confirm(      msg,      function (buttonIndex) {        if (buttonIndex == 2) {          Operation.terminate();          $location.url('/home');          toast($scope.translation.operationTerminated);          $scope.$apply();        }      },      $scope.translation.terminate + ' ' + $scope.translation.theOperation,      [$scope.translation.cancel, $scope.translation.terminate]    );  };  /**   * Redirige vers la page d'édition de victime.   * @func editVictime   * @memberof DashboardCtrl   * @param {int} num - Numéro de la victime à éditer   */  $scope.editVictime = function (num) {    $location.url('/victimes/' + num);  };  /**   * Redirige vers la page listant les intervenant pour un métier donné.   * @memberof DashboardCtrl   * @funct detailsMetier   * @param {string} lib - Libellé du métier recherché   */  $scope.detailsMetier = function (lib) {    $location.url('/metiers/' + lib);  };  /**   * Ouvre une modale avec un champs de saisie pour la sortie   * d'intervenant par son numéro.   * @memberof DashboardCtrl   * @func evacuatePersonnel   */  $scope.evacuatePersonnel = function () {    navigator.notification.prompt(      $scope.translation.dashboard.rescuerOutMsg,      checkPersonnel,      $scope.translation.dashboard.rescuerOut,      [$scope.translation.cancel, $scope.translation.validate]    );  };  /**   * Redirige vers la page de détails d'un métier.   * @memberof DashboardCtrl   * @func checkPersonnel   * @param {string} results - Libellé du métier recherché   */  function checkPersonnel(results) {    if (results.buttonIndex == 2) {      console.log($scope.translation.dashboard.rescuerOut, results.input1);      var personnel = Operation.getPersonnel(results.input1);      if (!personnel) { // Personnel inexistant        toast($scope.translation.intervenantNum + results.input1 + ' ' + $scope.translation.dashboard.notFound + '.');      } else if (personnel.endDate) { // L'intervenant est déjà sorti        console.log('Personnel déjà sorti');        navigator.notification.confirm(          $scope.translation.intervenantNum + personnel.numero + ' ' + $scope.translation.dashboard.isAlreadyOut + ' ' + personnel.endDate.toLocaleString(),          null, $scope.translation.alreadyOut, [$scope.translation.ok]        )      } else { // On sort l'intervenant        navigator.notification.confirm(          $scope.translation.dashboard.exit + ' : ' + personnel.metier.libelle + ' ' + $scope.translation.dashboard.number + personnel.numero + '.',          function (buttonIndex) {            if (buttonIndex == 2) {              console.log('buttonIndex', buttonIndex);              Operation.evacuatePersonnel(personnel);              toast($scope.translation.intervenants.number + personnel.numero + ' ' + $scope.translation.evacuated);              $scope.$apply();            }          },          $scope.translation.dashboard.confirmation, [$scope.translation.cancel, $scope.translation.validate]        )      }    } else { // Annulation      console.log($scope.translation.dashboard.exitCanceled);      toast($scope.translation.dashboard.exitCanceled);    }  }  /**   * Va vers l'index d'onglet passé en paramètre.   * @memberof DashboardCtrl   * @func goTab   * @param {int} index - Index de l'onglet recherché   */  $scope.goTab = function (index) {    $scope.activeTab = index;    Global.setDashboardTab(index);  };  /**   * Affiche l'onglet suivant.   * @memberof DashboardCtrl   * @func nextTab   */  $scope.nextTab = function () {    if ($scope.activeTab &lt;= 2) $scope.goTab(2);  };  /**   * Affiche l'onglet précédent.   * @memberof DashboardCtrl   * @func prevTab   */  $scope.prevTab = function () {    if ($scope.activeTab > 1) $scope.goTab(1);    else $rootScope.Ui.turnOn('uiSidebarLeft');  };  /**   * Met à jour l'opération dans le scope lorsque le local storage est modifié.   */  $scope.$on('operationUpdated', function () {    $scope.operation = Operation.getOperation();  });  /**   * Ferme l'application après avoir demandé la confirmation.   * @memberof DashboardCtrl   * @func exitApp   */  $scope.exitApp = function () {    Global.exitApp();  }});</code></pre>        </article>        <!-- index.html -->        <!-- class files -->      </div>      <footer style="clear:both">        Documentation generated by        <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a>        using        <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template</a>      </footer>    </div>    <script src="js/prettify.js"></script>    <script src="js/angular.min.js"></script>    <script src="js/site.js"></script>    <!--%= prettyJson %-->    <script>      prettyPrint();      var lineNo = window.location.hash.match(/#line([0-9]+)$/);      lineNo && document.querySelector("ol li:nth-child("+(lineNo[1])+")").scrollIntoView();    </script>  </body></html>